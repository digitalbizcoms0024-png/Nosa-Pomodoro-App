# Codebase Structure

**Analysis Date:** 2026-02-06

## Directory Layout

```
pomodoro/
├── .git/                     # Git history
├── .planning/                # Planning documents (generated by GSD)
│   └── codebase/            # Codebase analysis docs
├── index.html               # Main application (2738 lines: HTML + CSS + JS)
├── sw.js                    # Service worker for offline support
├── manifest.json            # PWA manifest for installability
├── CNAME                    # Custom domain (pomodorotimer.vip)
├── README.md                # Project documentation
├── CLAUDE.md                # Claude project instructions
└── .DS_Store                # macOS metadata (not committed)
```

## Directory Purposes

**Root Directory (`/`):**
- Purpose: Application files and configuration
- Contains: Single-file SPA, service worker, PWA manifest
- Key files: `index.html`, `sw.js`, `manifest.json`

**.git/**
- Purpose: Git version control metadata
- Contains: Commit history, branches
- Key files: `HEAD`, `config`, `objects/`, `refs/`

**.planning/codebase/**
- Purpose: GSD analysis documents
- Contains: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, TESTING.md, CONCERNS.md, STACK.md, INTEGRATIONS.md
- Generated by: GSD orchestrator during codebase mapping

## Key File Locations

**Entry Points:**

- `index.html`: Main single-file application
  - Serves as entry point for all traffic
  - Contains complete HTML structure, CSS styling, and JavaScript logic
  - Loaded by browser, initiates app via IIFE at line 1578

- `sw.js`: Service worker registration target
  - Registered in `init()` function at line 2726
  - Handles offline caching and PWA capabilities

**Configuration:**

- `manifest.json`: PWA Web App Manifest
  - Defines app name, icons, display mode, start URL
  - Used by browsers for app installation
  - Contains embedded SVG icons for app shortcuts

- `CNAME`: GitHub Pages custom domain
  - Contains: `pomodorotimer.vip`
  - GitHub Pages reads this to route traffic to custom domain

- `.env` files: **None present** (not needed - Firebase config is inline in HTML)

**Core Logic:**

- `index.html` contains all application logic:
  - **HTML Structure** (lines 1307-1556): DOM elements, semantic markup
  - **CSS Styling** (lines 11-1306): Custom properties, theming, responsive layout
  - **JavaScript** (lines 1560-2734):
    - Firebase initialization (lines 1560-1577)
    - Constants and DOM refs (lines 1578-1651)
    - State management (lines 1665-1679)
    - Storage functions (lines 1681-1724)
    - Task CRUD (lines 1726-1787)
    - Timer functions (lines 1791-2530)
    - Render functions (lines 1949-2425)
    - Event listeners (lines 2548-2690)
    - Init function (lines 2710-2733)

**Testing:**

- No test files - this is a frontend-only app without a build process
- Manual testing via browser or PWA installation

## Naming Conventions

**Files:**
- Lowercase with hyphens for multi-word names: `sw.js`, `manifest.json`
- Single entry point: `index.html`
- No file extensions for directories

**HTML Attributes (IDs/Classes):**
- kebab-case for IDs and classes: `#settingsDialog`, `.mode-tabs`, `.timer-container`
- Semantic naming: `#pageTimer`, `#tasksSection`, `#leaderboardDialog`
- ARIA attributes for accessibility: `role="tab"`, `aria-label="Timer"`, `aria-live="polite"`

**JavaScript:**
- camelCase for functions: `loadSettings()`, `updateProgressRing()`, `addTask()`
- camelCase for variables: `state`, `timeRemaining`, `dailyGoal`
- UPPERCASE for constants: `CIRCUMFERENCE`, `STORAGE_KEYS`, `CONFETTI_COLORS`, `DEFAULTS`
- Prefix underscore (not used): only standard pattern is no prefix

**CSS:**
- kebab-case for class names: `.timer-container`, `.ring-track`, `.stat-card`
- CSS custom properties (variables): `--bg`, `--primary`, `--text-secondary`, `--shadow-md`
- Semantic naming: `.mode-tabs`, `.timer-display`, `.session-dots`

**Storage Keys:**
- Prefixed with `pomodoro-`: `pomodoro-settings`, `pomodoro-stats`, `pomodoro-theme`, `pomodoro-tasks`
- Stored in browser localStorage

**Data Structures:**

Task object:
```javascript
{
  id: string (timestamp),
  title: string,
  completed: boolean
}
```

Settings object:
```javascript
{
  focusDuration: number,
  breakDuration: number,
  longBreakDuration: number,
  longBreakInterval: number,
  autoStart: boolean,
  soundEnabled: boolean,
  dailyGoal: number,
  dailyGoalUnit: 'minutes' | 'hours' | 'pomodoros'
}
```

Stats object:
```javascript
{
  totalPomodoros: number,
  dailyCounts: { dateKey: count },
  dailyMinutes: { dateKey: minutes },
  bestStreak: number
}
```

## Where to Add New Code

**New Feature (e.g., new timer mode):**
- Add state property to `state` object (line 1666)
- Add constants/defaults if needed to `DEFAULTS` (line 1654)
- Add event listener in "Event listeners" section (line 2547+)
- Add render/update function near line 1949+
- Add CSS styling in theme definitions (line 14+)
- Add HTML markup in `index.html` (lines 1310-1415)

**New Dialog/Modal:**
- Add HTML `<dialog>` element before `</body>` (around line 1428+)
- Add CSS for dialog styling in style block (line 11+)
- Add open function near other dialog handlers (~line 1880+)
- Add close/backdrop listeners (~line 1929+)
- Add event listener to open button (line 2574+)

**New Statistics/Metric:**
- Add calculation function near `updateStats()` (line 2126)
- Add stat display HTML in stats dialog (line 1514+)
- Add DOM element reference at top (line 1593+)
- Add update call in `updateStats()` function

**New Task-like Feature:**
- Follow task model: create, read, update, delete functions
- Store in `state.tasks` (line 1678) or new `state.collections.X`
- Persist to localStorage via `saveTasks()` pattern
- Render to DOM via `renderTasks()` pattern
- Add event listeners to new elements

**Utility Function:**
- Add near related functions (e.g., time utilities near `formatTime()` at line 1791)
- Use camelCase naming: `calculateStreak()`, `formatTimeByUnit()`
- Keep logic small and focused
- Call from relevant event handlers or update functions

## File Dependencies

**`index.html` depends on:**
- Firebase SDK (loaded from CDN): Auth, Firestore
- Browser APIs: localStorage, Notification, setInterval, DOM
- `manifest.json`: linked via `<link rel="manifest">`
- `sw.js`: registered at line 2726

**`sw.js` depends on:**
- Cache API: `caches.open()`, `caches.match()`, `caches.delete()`
- Fetch API: handles network requests
- `index.html`: caches this file as `./`

**`manifest.json` depends on:**
- Referenced by `index.html` at line 9
- Used by browser for PWA installation

## Special Directories

**.git/**
- Purpose: Version control history
- Generated: Yes (by git)
- Committed: Yes (part of repo)
- Contains: Full commit history since initial commit

**.planning/codebase/**
- Purpose: GSD analysis and planning documents
- Generated: Yes (by `/gsd:map-codebase` command)
- Committed: Yes (tracked in git)
- Contains: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, TESTING.md, CONCERNS.md, STACK.md, INTEGRATIONS.md

**dist/ or build/**
- Not used: No build process
- All code is served directly from source files

**node_modules/ or dependencies**
- Not used: No package manager
- Firebase and other libraries loaded from CDN

## Code Organization Within index.html

The single `index.html` file is organized into sections:

1. **HEAD** (lines 1-1308):
   - Meta tags, viewport, favicon
   - Inline CSS styling (Custom properties, theme definitions, component styles, responsive media queries)

2. **BODY HTML** (lines 1309-1556):
   - Header with logo, auth button, settings/theme buttons
   - Main timer display (mode tabs, SVG progress ring, controls)
   - Tasks section (collapsible task list)
   - Dialog modals (Settings, Stats, Leaderboard)
   - Theme toggle button
   - Service worker activation

3. **Firebase Setup Script** (lines 1560-1577):
   - Load Firebase SDK from CDN
   - Initialize Firebase with config

4. **Main Application Script** (lines 1578-2734):
   - IIFE wrapper for scope isolation
   - Constants and DOM references
   - State object
   - Storage functions (load/save)
   - Task CRUD functions
   - Timer functions
   - Render/Update functions
   - Event listener setup
   - Init function

## Static Assets and Resources

**Embedded Icons (SVG):**
- Logo icon: lines 1312-1321 (inline SVG)
- Google Sign-In icon: lines 1326, 1406 (inline SVG)
- Stats icon: lines 1330-1332 (inline SVG)
- Leaderboard icon: lines 1335-1337 (inline SVG)
- Settings icon: lines 1340-1342 (inline SVG)
- Close icon: lines 1432-1434 (inline SVG)
- Theme toggle icons: lines 1418-1423 (sun/moon SVG)
- Timer circles: lines 1361-1365 (SVG progress ring)
- All other icons embedded in HTML

**Favicon:**
- Data URI SVG embedded in `<link rel="icon">` (line 10)
- No external favicon file needed

**Fonts:**
- System font stack: `-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif`
- No web fonts loaded from CDN

---

*Structure analysis: 2026-02-06*
